<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operator Admin - ‡∏Å‡∏∏‡∏¢‡∏ä‡πà‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏∂‡∏á</title>

    <!-- Fonts: Local Prompt -->
    <style>
        @font-face {
            font-family: 'Prompt';
            src: url('fonts/Prompt-Light.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
        }

        @font-face {
            font-family: 'Prompt';
            src: url('fonts/Prompt-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Prompt';
            src: url('fonts/Prompt-Medium.ttf') format('truetype');
            font-weight: 500;
            font-style: normal;
        }

        @font-face {
            font-family: 'Prompt';
            src: url('fonts/Prompt-SemiBold.ttf') format('truetype');
            font-weight: 600;
            font-style: normal;
        }

        @font-face {
            font-family: 'Prompt';
            src: url('fonts/Prompt-Bold.ttf') format('truetype');
            font-weight: 700;
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Config -->
    <script src="config.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-500: #6b7280;
            --gray-800: #1f2937;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: #f8fafc;
            color: var(--gray-800);
            margin: 0;
            padding: 0;
            padding-bottom: 80px;
            /* For bottom bar if needed, or just scroll space */
        }

        .container {
            max-width: 600px;
            margin: auto;
            padding: 16px;
        }

        /* ===== Header ===== */
        .header {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shop-info h1 {
            margin: 0;
            font-size: 18px;
            color: var(--primary-dark);
        }

        .shop-info p {
            margin: 4px 0 0;
            font-size: 13px;
            color: var(--gray-500);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-open {
            background: #dcfce7;
            color: #166534;
        }

        .status-closed {
            background: #fee2e2;
            color: #991b1b;
        }

        /* ===== Section Cards ===== */
        .card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--gray-100);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ===== Menu Summary ===== */
        .menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 15px;
        }

        .menu-qty {
            font-weight: 700;
            color: var(--primary);
            font-size: 18px;
        }

        .menu-total-row {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 2px dashed var(--gray-200);
            display: flex;
            justify-content: space-between;
            font-weight: 700;
        }

        /* ===== Order List ===== */
        .order-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .order-card {
            background: var(--gray-100);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .customer-name {
            font-weight: 600;
        }

        .order-time {
            font-size: 12px;
            color: var(--gray-500);
        }

        .order-items-text {
            font-size: 14px;
            color: var(--gray-500);
            margin-bottom: 8px;
        }

        .order-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid var(--gray-200);
            background: white;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .btn-paid.active {
            background: #dcfce7;
            color: #166534;
            border-color: #86efac;
        }

        .btn-delivered.active {
            background: #dbeafe;
            color: #1e40af;
            border-color: #93c5fd;
        }

        /* ===== Financial ===== */
        .fin-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .profit-row {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e5e7eb;
            font-weight: 700;
            color: #10b981;
            font-size: 18px;
        }

        /* ===== Table View Styles ===== */
        .order-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .order-table th,
        .order-table td {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
        }

        .order-table th {
            background: #f3f4f6;
            font-weight: 600;
            color: #374151;
        }

        .order-table tr:hover {
            background: #f9fafb;
        }

        .view-toggle-btn {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            color: #6b7280;
        }

        .view-toggle-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ===== Close Button ===== */
        .btn-close-round {
            width: 100%;
            padding: 16px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-create-round {
            width: 100%;
            padding: 16px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 30px;
            /* Spacer */
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- 1. Header -->
        <div class="header">
            <div class="shop-info">
                <h1>üì¶ ‡∏Å‡∏∏‡∏¢‡∏ä‡πà‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏∂‡∏á</h1>
                <p id="currentDate">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
                <a href="history.html"
                    style="text-decoration:none; color:var(--primary); font-size:14px; font-weight:600;">
                    <i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                </a>
                <span id="roundStatus" class="status-badge">...</span>
            </div>
        </div>

        <!-- 2. Menu Summary -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-clipboard-list"></i> ‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                </div>
            </div>
            <ul class="menu-list" id="menuSummaryList">
                <!-- Items will be here -->
                <li style="text-align:center; color:#9ca3af;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</li>
            </ul>
            <div class="menu-total-row" id="menuTotalRow" style="display:none;">
                <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                <span id="totalBoxCount">0 ‡∏Å‡∏•‡πà‡∏≠‡∏á</span>
            </div>
        </div>

        <!-- 3. Order List -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-users"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
                    <span id="orderCountBadge"
                        style="background:var(--gray-200); padding:2px 8px; border-radius:12px; font-size:12px;">0</span>
                </div>
            </div>

            <!-- Search & View Toggle -->
            <div style="margin-bottom: 12px; display:flex; gap:10px;">
                <input type="text" id="orderSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô..."
                    onkeyup="renderOrderList()"
                    style="flex:1; padding:10px; border:1px solid #e5e7eb; border-radius:8px; font-family:'Prompt';">

                <button class="view-toggle-btn active" id="btnViewList" onclick="switchView('list')">
                    <i class="fas fa-list"></i>
                </button>
                <button class="view-toggle-btn" id="btnViewTable" onclick="switchView('table')">
                    <i class="fas fa-table"></i>
                </button>
            </div>

            <div id="orderListContainer">
                <!-- Orders will be here -->
            </div>
        </div>

        <!-- 4. Financial -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-wallet"></i> ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô
                </div>
            </div>
            <div class="fin-row">
                <span>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏£‡∏±‡∏ö)</span>
                <span id="totalRevenue">0 ‡∏ø</span>
            </div>
            <div class="fin-row" style="color:var(--danger)">
                <span>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏à‡πà‡∏≤‡∏¢)</span>
                <span id="totalCost">0 ‡∏ø</span>
            </div>
            <div class="fin-row profit-row">
                <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                <span id="totalProfit">0 ‡∏ø</span>
            </div>
        </div>

        <!-- 5. Close Round -->
        <button class="btn-close-round" onclick="handleCloseRound()">
            <i class="fas fa-lock"></i> ‡∏õ‡∏¥‡∏î‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        </button>

        <!-- 6. Create Round (Show if no open round) -->
        <button id="btnCreateRound" class="btn-create-round" onclick="handleCreateRound()"
            style="display:none; margin-top:10px;">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
        </button>
    </div>

    <script>
        // Init Supabase
        const supabaseClient = initSupabase();

        let currentRound = null;
        let orders = [];
        let orderItems = [];
        let currentView = 'list'; // 'list' or 'table'

        function switchView(view) {
            currentView = view;
            document.getElementById('btnViewList').className = view === 'list' ? 'view-toggle-btn active' : 'view-toggle-btn';
            document.getElementById('btnViewTable').className = view === 'table' ? 'view-toggle-btn active' : 'view-toggle-btn';
            renderOrderList();
        }

        // Main function to load everything
        async function loadData() {
            if (!supabaseClient) return;

            // 1. Get Latest Round (Regardless of status)
            const { data: round, error } = await supabaseClient
                .from('rounds')
                .select('*')
                .order('delivery_date', { ascending: false })
                .limit(1)
                .single();

            if (round) {
                currentRound = round;
                updateHeader(round);
                await fetchOrders(round.id);

                // Control Buttons based on status
                if (round.status === 'OPEN') {
                    document.querySelector('.btn-close-round').style.display = 'block';
                    document.getElementById('btnCreateRound').style.display = 'none';
                } else {
                    document.querySelector('.btn-close-round').style.display = 'none';
                    document.getElementById('btnCreateRound').style.display = 'block';
                }

                // Subscribe to Realtime
                supabaseClient
                    .channel('public:orders')
                    .on('postgres_changes', { event: '*', schema: 'public', table: 'orders' }, (payload) => {
                        // Reload if it belongs to this round
                        if (payload.new.round_id === round.id || payload.old.round_id === round.id) {
                            fetchOrders(round.id);
                        }
                    })
                    .subscribe();

                supabaseClient
                    .channel('public:order_items')
                    .on('postgres_changes', { event: '*', schema: 'public', table: 'order_items' }, () => {
                        fetchOrders(round.id);
                    })
                    .subscribe();
            } else {
                // No rounds at all
                document.getElementById('currentDate').innerText = '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≠‡∏ö)';
                document.getElementById('roundStatus').style.display = 'none';
                document.querySelector('.btn-close-round').style.display = 'none';
                document.getElementById('btnCreateRound').style.display = 'block';
            }
        }

        function updateHeader(round) {
            const date = new Date(round.delivery_date);
            const dateStr = date.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
            document.getElementById('currentDate').innerText = `‡∏£‡∏≠‡∏ö‡∏™‡πà‡∏á: ${dateStr}`;

            const badge = document.getElementById('roundStatus');
            badge.innerText = round.status;
            badge.className = `status-badge ${round.status === 'OPEN' ? 'status-open' : 'status-closed'}`;
        }

        async function fetchOrders(roundId) {
            // Get Orders
            const { data: ordersData } = await supabaseClient
                .from('orders')
                .select('*')
                .eq('round_id', roundId)
                .order('created_at', { ascending: false });

            orders = ordersData || [];
            document.getElementById('orderCountBadge').innerText = orders.length;

            // Get Order Items
            // Need to get all items for these orders
            const orderIds = orders.map(o => o.id);
            if (orderIds.length > 0) {
                const { data: itemsData } = await supabaseClient
                    .from('order_items')
                    .select('*')
                    .in('order_id', orderIds);
                orderItems = itemsData || [];
            } else {
                orderItems = [];
            }

            renderMenuSummary();
            renderOrderList();
            renderFinancial();
        }

        function renderMenuSummary() {
            const summary = {};
            let totalBoxes = 0;

            orderItems.forEach(item => {
                summary[item.menu_name] = (summary[item.menu_name] || 0) + item.quantity;
                totalBoxes += item.quantity;
            });

            const list = document.getElementById('menuSummaryList');
            list.innerHTML = '';

            if (Object.keys(summary).length === 0) {
                list.innerHTML = '<li style="text-align:center; color:#9ca3af;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</li>';
                document.getElementById('menuTotalRow').style.display = 'none';
                return;
            }

            for (const [name, qty] of Object.entries(summary)) {
                list.innerHTML += `
                    <li class="menu-item">
                        <span>${name}</span>
                        <span class="menu-qty">x${qty}</span>
                    </li>
                `;
            }

            document.getElementById('totalBoxCount').innerText = `${totalBoxes} ‡∏Å‡∏•‡πà‡∏≠‡∏á`;
            document.getElementById('menuTotalRow').style.display = 'flex';
        }

        function renderOrderList() {
            const container = document.getElementById('orderListContainer');
            const searchText = document.getElementById('orderSearch').value.toLowerCase();
            container.innerHTML = '';

            let filteredOrders = orders.filter(order => {
                const searchStr = (order.customer_name + ' ' + order.department).toLowerCase();
                return searchStr.includes(searchText);
            });

            if (currentView === 'table') {
                // TABLE VIEW
                let tableHtml = `
                    <div style="overflow-x:auto;">
                    <table class="order-table">
                        <thead>
                            <tr>
                                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                filteredOrders.forEach(order => {
                    const myItems = orderItems.filter(i => i.order_id === order.id);
                    const itemText = myItems.map(i => `${i.menu_name} x${i.quantity}`).join('<br>'); // Use BR for table
                    const isPaid = order.payment_status === 'paid';
                    const isDelivered = order.delivery_status === 'delivered';

                    tableHtml += `
                        <tr>
                            <td>
                                <strong>${order.customer_name}</strong><br>
                                <span style="font-size:12px; color:#6b7280;">${order.department}</span>
                            </td>
                            <td>${itemText}</td>
                            <td>${order.total_price}‡∏ø</td>
                            <td>
                                <div style="display:flex; gap:5px; flex-direction:column;">
                                    <button class="action-btn btn-paid ${isPaid ? 'active' : ''}" style="padding:4px; font-size:12px;" onclick="toggleStatus('${order.id}', 'payment_status', '${isPaid ? 'pending' : 'paid'}')">
                                        ${isPaid ? 'üí∞ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‡∏£‡∏≠‡∏à‡πà‡∏≤‡∏¢'}
                                    </button>
                                    <button class="action-btn btn-delivered ${isDelivered ? 'active' : ''}" style="padding:4px; font-size:12px;" onclick="toggleStatus('${order.id}', 'delivery_status', '${isDelivered ? 'pending' : 'delivered'}')">
                                        ${isDelivered ? 'üì¶ ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' : '‡∏£‡∏≠‡∏™‡πà‡∏á'}
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                tableHtml += '</tbody></table></div>';
                container.innerHTML = tableHtml;

            } else {
                // LIST VIEW (Original)
                filteredOrders.forEach(order => {
                    const myItems = orderItems.filter(i => i.order_id === order.id);
                    const itemText = myItems.map(i => `${i.menu_name} x${i.quantity}`).join(', ');
                    const isPaid = order.payment_status === 'paid';
                    const isDelivered = order.delivery_status === 'delivered';

                    container.innerHTML += `
                        <div class="order-card">
                            <div class="order-header">
                                <span class="customer-name">${order.customer_name} (${order.department})</span>
                                <span class="order-time">${new Date(order.created_at).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                            <div class="order-items-text">
                                ${itemText}
                            </div>
                            <div class="order-actions">
                                <button class="action-btn btn-paid ${isPaid ? 'active' : ''}" onclick="toggleStatus('${order.id}', 'payment_status', '${isPaid ? 'pending' : 'paid'}')">
                                    <i class="fas fa-money-bill"></i> ${isPaid ? '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‡∏£‡∏≠‡∏à‡πà‡∏≤‡∏¢'}
                                </button>
                                <button class="action-btn btn-delivered ${isDelivered ? 'active' : ''}" onclick="toggleStatus('${order.id}', 'delivery_status', '${isDelivered ? 'pending' : 'delivered'}')">
                                    <i class="fas fa-box"></i> ${isDelivered ? '‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß' : '‡∏£‡∏≠‡∏™‡πà‡∏á'}
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
        }

        function renderFinancial() {
            let revenue = 0;
            let cost = 0;

            orderItems.forEach(item => {
                revenue += item.sell_price || 0;
                cost += item.cost_price || 0;
            });

            const profit = revenue - cost;

            document.getElementById('totalRevenue').innerText = revenue.toLocaleString() + ' ‡∏ø';
            document.getElementById('totalCost').innerText = cost.toLocaleString() + ' ‡∏ø';
            document.getElementById('totalProfit').innerText = profit.toLocaleString() + ' ‡∏ø';
        }

        async function toggleStatus(id, field, value) {
            // 1. Optimistic Update (Update UI Immediately)
            const orderIndex = orders.findIndex(o => o.id === id);
            if (orderIndex > -1) {
                orders[orderIndex][field] = value;
                renderOrderList();
            }

            // 2. Send to Backend
            await supabaseClient.from('orders').update({ [field]: value }).eq('id', id);
        }

        async function handleCloseRound() {
            if (!currentRound) return;

            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏£‡∏≠‡∏ö?',
                text: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: '‡∏õ‡∏¥‡∏î‡∏£‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ'
            });

            if (result.isConfirmed) {
                await supabaseClient.from('rounds').update({ status: 'CLOSED' }).eq('id', currentRound.id);
                window.location.reload();
            }
        }

        async function handleCreateRound() {
            const { value: dateStr } = await Swal.fire({
                title: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                input: 'date',
                inputLabel: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á',
                inputValue: new Date().toISOString().split('T')[0],
                showCancelButton: true,
                confirmButtonText: '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏¢',
                confirmButtonColor: '#10b981'
            });

            if (dateStr) {
                const { error } = await supabaseClient
                    .from('rounds')
                    .insert({
                        shop_name: '‡∏Å‡∏∏‡∏¢‡∏ä‡πà‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô‡∏ö‡∏∂‡∏á',
                        delivery_date: dateStr,
                        status: 'OPEN'
                    });

                if (error) {
                    Swal.fire('Error', error.message, 'error');
                } else {
                    await Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', 'success');
                    window.location.reload();
                }
            }
        }

        // Start
        if (supabaseClient) {
            loadData();
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Configuration Error',
                text: 'Please setup config.js with your Supabase credentials'
            });
        }
    </script>
</body>

</html>